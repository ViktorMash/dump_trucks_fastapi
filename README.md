# Система мониторинга самосвалов
Веб-приложение на FastAPI для отслеживания загрузки самосвалов различных моделей, работающих в карьере. Система позволяет контролировать степень загрузки самосвалов относительно их максимальной грузоподъемности и выявлять случаи перегруза.

## Функциональность
- REST API для управления самосвалами и моделями
- Получение списка самосвалов с информацией о модели, максимальной грузоподъемности, текущей загрузке и проценте перегруза
- Фильтрация списка самосвалов по модели и бортовому номеру
- Автоматическое вычисление процента перегруза и статуса перегрузки
- Пагинация результатов

## Структура проекта
```
README.md                        # Документация проекта
dump_trucks_fastapi/             # Основная директория проекта
    main.py                      # Точка входа приложения
    db.sqlite3                   # База данных SQLite
    
    app/                         # Основной пакет приложения
        __init__.py
        
        api/                     # API endpoints
            __init__.py
            trucks.py            # Маршруты для самосвалов и моделей
        
        config/                  # Конфигурация
            __init__.py
            config.py            # Настройки приложения
        
        core/                    # Бизнес-логика
            __init__.py
            init_test_data.py    # Инициализация тестовых данных
            response_api.py      # Стандартизированные ответы API
            
            crud/                # CRUD операции
                __init__.py
                truck.py         # Операции с самосвалами
                truck_model.py   # Операции с моделями
        
        db/                      # База данных
            __init__.py
            session.py           # Подключение к БД и сессии
            
            models/              # ORM модели
                __init__.py
                _base.py         # Базовая модель
                trucks.py        # Модели самосвалов
        
        schemas/                 # Pydantic схемы
            __init__.py
            trucks.py            # Схемы самосвалов
            truck_models.py      # Схемы моделей
            
            http_response/       # Схемы ответов
                __init__.py
                exceptions_model.py  # Исключения моделей
                exceptions_truck.py  # Исключения самосвалов
                response.py          # Схемы ответов API
        
        utils/                   # Утилиты
            __init__.py
            response_description.py  # Описания статусов HTTP
```

## Предварительные требования
- Python 3.11+
- FastAPI
- SQLAlchemy 2.0+
- Pydantic 2.0+
- SQLite (или любая другая поддерживаемая СУБД)

## Установка
1. Клонировать репозиторий: `git clone https://github.com/ViktorMash/dump_trucks_fastapi.git`
2. Создать виртуальное окружение: `python -m venv venv`
3. Активировать виртуальное окружение:
   - Linux/Mac: `source venv/bin/activate`
   - Windows: `venv\Scripts\activate`
4. Установить зависимости: `pip install -r requirements.txt`

## Информация о базе данных
- Проект использует SQLite в качестве СУБД по умолчанию
- База данных создается автоматически при первом запуске
- Тестовые данные добавляются автоматически при инициализации

**Примечание:** Если вы хотите использовать другую СУБД, измените настройки подключения в файле `app/config/config.py` в классе `DataBaseSettings` и установите соответствующие драйверы.

## Запуск
1. Перейти в каталог приложения: `cd dump_trucks_fastapi`
2. Запустить сервер: `python main.py` или `uvicorn main:app --reload`
3. Открыть в браузере:
   - API документация (Swagger): http://127.0.0.1:8000/docs
   - Альтернативная документация (ReDoc): http://127.0.0.1:8000/redoc
4. Остановить сервер: `Ctrl + C`

## API Endpoints

### Самосвалы
- `GET /api/v1/trucks/` - Получить список самосвалов с фильтрацией и пагинацией
- `GET /api/v1/trucks/{truck_id}` - Получить самосвал по ID
- `POST /api/v1/trucks/` - Создать новый самосвал
- `PUT /api/v1/trucks/{truck_id}` - Обновить самосвал
- `DELETE /api/v1/trucks/{truck_id}` - Удалить самосвал

### Модели самосвалов
- `GET /api/v1/trucks/models` - Получить список всех моделей

### Параметры фильтрации
- `board_number` - Фильтр по бортовому номеру
- `model_name` - Фильтр по названию модели
- `skip` - Смещение для пагинации (по умолчанию: 0)
- `limit` - Количество записей на страницу (по умолчанию: 50, максимум: 100)

## Формат ответов API
### Успешные ответы
Все успешные ответы имеют стандартизированный формат:
Для одной страницы:
```json
{
  "data": [...],
  "meta": {
    "total": 3,
    "page": 1,
    "per_page": 50,
    "total_pages": 1
  }
}
```
Для множественных страниц:
```json
{
  "data": [...],
  "meta": {
    "total": 150,
    "page": 2,
    "per_page": 50,
    "total_pages": 3
  },
  "links": {
    "self": "/api/v1/trucks?page=2&per_page=50",
    "first": "/api/v1/trucks?page=1&per_page=50",
    "prev": "/api/v1/trucks?page=1&per_page=50",
    "next": "/api/v1/trucks?page=3&per_page=50",
    "last": "/api/v1/trucks?page=3&per_page=50"
  }
}
```
### Ответы с ошибками
```json
{
  "error": "TruckNotFound",
  "message": "Самосвал с ID 999 не найден",
  "status_code": 404
}
```

## Вычисляемые поля
Для каждого самосвала автоматически вычисляются:
- `load_percentage` - Процент загрузки от максимальной грузоподъемности
- `overload_percentage` - Процент перегруза (только если > 100%)
- `is_overloaded` - Флаг перегрузки (true/false)

## Тестовые данные
При первом запуске автоматически создаются:
- 2 модели самосвалов: БЕЛАЗ (120т), Komatsu (110т)
- 3 самосвала: 101 (100т), 102 (125т), K103 (120т)

## Если возникли проблемы:
- Убедитесь, что порт 8000 не занят другими приложениями
- Проверьте, что виртуальное окружение активировано
- Проверьте наличие всех необходимых пакетов
- Удалите файл `db.sqlite3` для пересоздания базы данных